<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Agile Poker</title>
        <link rel="stylesheet" href="/style/app.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.1.0/chosen.min.css">
        <link rel="image_src" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.1.0/chosen-sprite.png">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.1.0/chosen.jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.15/angular.min.js"></script>
        <script src="/js/jquery/angular-chosen.min.js" ></script>
        <style>
            .chosen-container {
                width: 57%  !important;
            }
            .chosen-choices {
                min-height: 50px;
                border-radius: 5px;
            }
        </style>
    </head>
    <body ng-app="system">
        <div class="content" ng-controller="HomeController" ng-cloak>
            <h1>Hello, I'm Agile Poker</h1>
            <div class="side-access">
                <select multiple class="js-select-projects" ng-model="selectedProject" ng-options="p.id as p.name for p in projects"></select>
                <span ng-click="goTeam()" class="btn w50 btn-orange" alt="Team side">Team side </span>
                <a href="/master" class="btn w50 btn-blue" alt="Master side">Master side </a>
            </div>
        </div>
    </body>
    <script>
        var ticketSite = 'https://ticket.megaads.test';
        var ticketApi = 'https://ticket.megaads.test/api';
        var system = angular.module('system', ['angular.chosen']);
        system.controller('HomeController', HomeController);

        function HomeController($rootScope, $scope, $http) {
            $scope.projects = [];
            $scope.selectedProject = [];

            this.initialize = () => {
                $scope.fetchProject();
            }
            $scope.fetchProject = () => {
                $http.get(`${ticketApi}/project`, {params: {fields: 'id,name'}})
                    .then(res => {
                        const data = res.data;
                        if (data.status === 'successful') {
                            $scope.projects = data.result;
                            setTimeout(function() {
                                $('.js-select-projects').chosen();
                            }, 200);
                        }
                    });
            }
            $scope.goTeam = () => {
                window.location = `/team?projects=${$scope.selectedProject.join(';')}`;
            }
            this.initialize();
        }
    </script>
</html>
